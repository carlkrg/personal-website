const cities={Lisbon:{country:'Portugal',latitude:38.7223,longitude:-9.1393,logos:["static/img/nova-logo.svg"],},Berlin:{country:'Germany',latitude:52.52,longitude:13.405,logos:["static/img/hwr-logo.svg","static/img/KPMG-logo.svg","static/img/tu-logo.svg",],},Shanghai:{country:'China',latitude:31.2304,longitude:121.4737,logos:["static/img/dss-logo.svg"],},Bonn:{country:'Germany',latitude:50.7374,longitude:7.0982,logos:[]},"New Delhi":{country:'India',latitude:28.6139,longitude:77.209,logos:["static/img/DSND-logo.svg"],},};const svgMarker=`data:image/svg+xml;base64,${btoa(
  '<svg xmlns="http://www.w3.org/2000/svg" height="16" width="12" viewBox="0 0 384 512"><path d="M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"/></svg>'
)}`;const markerWidth=20;const markerHeight=30;const markerRadius=3;function drawMap(){const svgContainer=d3.select("#my_dataviz");svgContainer.selectAll("*").remove();const panel=document.getElementById("panel-1");const containerWidth=panel.clientWidth;const containerHeight=panel.clientHeight*2;let zoomScale=containerWidth/(1.2*Math.PI);if(window.innerWidth<=768){zoomScale=containerWidth/(1.0*Math.PI);}
const svg=svgContainer.attr("width",containerWidth).attr("height",containerHeight);const projection=d3.geoMercator().center([60,36]).scale(zoomScale).translate([containerWidth/2,containerHeight/2]);d3.json("static/img/custom.geo.json").then(function(data){const path=d3.geoPath().projection(projection);svg.append("g").selectAll("path").data(data.features).join("path").attr("fill",(d)=>{switch(d.properties.name){case"Portugal":return"#7ddf98";case"China":return"#7ddf98";case"India":return"#7ddf98";case"Germany":return"#7ddf98";default:return"#e6e6e6";}}).attr("d",path).style("stroke","#e6e6e6").on("click",function(event,d){if(isMobile){console.log(d.properties.name+" was clicked.");svg.selectAll(".country-logo").remove();Object.entries(cities).forEach(([city,info])=>{if(info.country===d.properties.name){const logoSpacing=120;const logoMarginTop=0.3*svg.node().getBoundingClientRect().height;const logoXStart=10;info.logos.forEach((logo,index)=>{const logoX=logoXStart+(index*logoSpacing);const logoY=logoMarginTop;svg.append("image").attr("xlink:href",logo).attr("x",logoX).attr("y",logoY).attr("width",100).attr("height",100).attr("class","country-logo").style("opacity",1);});}});}});const isMobile=window.innerWidth<=768;const markers=svg.selectAll(".marker").data(Object.entries(cities)).enter();if(!isMobile){svg.selectAll(".city-label").data(Object.entries(cities)).enter().append("text").attr("x",(d)=>projection([d[1].longitude,d[1].latitude])[0]).attr("y",(d)=>projection([d[1].longitude,d[1].latitude])[1]-markerHeight).text((d)=>d[0]).attr("class","city-label").attr("text-anchor","middle").attr("dy","-1em");markers.append("image").attr("xlink:href",svgMarker).attr("x",(d)=>projection([d[1].longitude,d[1].latitude])[0]-markerWidth/2).attr("y",(d)=>projection([d[1].longitude,d[1].latitude])[1]-markerHeight).attr("width",markerWidth).attr("height",markerHeight).attr("class","marker").on("mouseover",function(event,d){d3.select(this).attr("width",markerWidth*1.2).attr("height",markerHeight*1.2);const[x,y]=projection([d[1].longitude,d[1].latitude]);const logoSpacing=70;d[1].logos.forEach((logo,index)=>{const logoX=x+markerWidth/2+20;const logoY=y-
30+
index*logoSpacing-
(d[1].logos.length*logoSpacing)/2;svg.append("image").attr("xlink:href",logo).attr("x",logoX).attr("y",logoY).attr("width",100).attr("height",100).attr("class","city-logo").style("opacity",1);});}).on("mouseout",function(){d3.select(this).attr("width",markerWidth).attr("height",markerHeight);svg.selectAll(".city-logo").remove();});}else{markers.append("circle").attr("cx",(d)=>projection([d[1].longitude,d[1].latitude])[0]).attr("cy",(d)=>projection([d[1].longitude,d[1].latitude])[1]).attr("r",markerRadius).attr("fill","#000000").attr("class","marker");}});}
drawMap();